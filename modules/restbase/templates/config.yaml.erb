# RESTBase config for small wiki installs
#
# - sqlite backend
# - parsoid at http://localhost:8142
# - wiki at http://localhost/w/api.php
#
# Quick setup:
# - npm install
#   If you see errors about sqlite, you might have to `apt-get install
#   libsqlite3-dev`.
# - cp config.example.yaml config.yaml
# - double-check and possibly modify lines marked with XXX, then start restbase with
#
#   node server
#
# - If all went well, http://localhost:7231/localhost/v1/page/html/Main_Page
# should show your wiki's [[Main Page]].

droidwiki.org: &droidwiki.org
  x-modules:
    - path: projects/droidwiki.yaml
      options:
        action:
          apiUriTemplate: "{{'https://{domain}/w/api.php'}}"
          baseUriTemplate: "{{'https://{domain}:7231/{domain}/v1'}}"
        parsoid:
          host: http://37.120.178.25:8142
        mobileapps:
          host: http://donut.dwnet:6927
        summary:
          implementation: mcs
          host: http://donut.dwnet:6927
        table:
          backend: sqlite
          dbname: db.sqlite3
          pool_idle_timeout: 20000
          retry_delay: 250
          retry_limit: 10
          show_sql: false
        citoid:
          host: https://go2tech.de/citoid
        transform:
          cx_host: http://localhost:7232/v1
        purged_cache_control: s-maxage=0, max-age=86400
        purged_cache_control_client_cache: s-maxage=0, max-age=300

services:
  - name: restbase
    module: hyperswitch
    conf:
      port: 7231
      host: 0.0.0.0
      salt: secret
      default_page_size: 125
      user_agent: RESTBase
      ui_name: RESTBase
      ui_url: https://www.mediawiki.org/wiki/RESTBase
      ui_title: RESTBase docs
      spec:
        x-request-filters:
          - path: lib/security_response_header_filter.js
        x-sub-request-filters:
          - type: default
            name: http
            options:
              allow:
                - pattern: /^https?:\/\/[a-zA-Z0-9\.]+\/w\/api\.php/
                  forward_headers: true
                - pattern: /^https?:\/\//
        paths:
          /{domain:www.droidwiki.org}: *droidwiki.org
          /{domain:en.droidwiki.org}: *droidwiki.org

# Finally, a standard service-runner config.
info:
  name: restbase

logging:
  name: restbase
  level: info

